{% block content %}
<section class="card">
  <h2>Forgot Password</h2>

  {% if error %}
  <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <div id="success-message" style="display: none;" class="alert alert-success"></div>
  <div id="error-message" style="display: none;" class="alert alert-danger"></div>

  <form id="forgot-password-form" autocomplete="off">
    <label for="email">Email</label>
    <input id="email" name="email" type="email" required />

    <button type="submit">Send Reset Link</button>
  </form>

  <p style="margin-top: 1rem; text-align: center;">
    <a href="/login">Back to Login</a>
  </p>
</section>

<script>
  const form = document.getElementById('forgot-password-form');
  const successDiv = document.getElementById('success-message');
  const errorDiv = document.getElementById('error-message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value;

    // Hide previous messages
    successDiv.style.display = 'none';
    errorDiv.style.display = 'none';

    try {
      const response = await fetch('/api/forgot-password', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email }),
      });

      const data = await response.json();

      if (response.ok) {
        successDiv.textContent = data.message || 'Reset link sent successfully! Check your email.';
        successDiv.style.display = 'block';
        form.reset();
      } else {
        errorDiv.textContent = data.error || 'Error sending reset email.';
        errorDiv.style.display = 'block';
      }
    } catch (error) {
      errorDiv.textContent = 'Error connecting to server.';
      errorDiv.style.display = 'block';
    }
  });
</script>
{% endblock %}